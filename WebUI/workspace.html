<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ›ä½œç©ºé—´ | Creation Workspace</title>
    <style>
        @keyframes glow {
            from { box-shadow: 0 0 10px rgba(55, 194, 212, 0.5); }
            to { box-shadow: 0 0 20px rgba(55, 194, 212, 0); }
        }

        body {
            margin: 0;
            padding: 20px;
            background: #f0f9ff;
            min-height: 100vh;
            font-family: 
                "Microsoft YaHei",
                "PingFang SC",
                "Helvetica Neue",
                Arial, 
                sans-serif;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }

        h1 {
            text-align: center;
            color: #1a4d5c;
            font-size: 2.5em;
            margin-bottom: 40px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .creation-form {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin: 40px 0;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            width: 100%;
        }

        .input-label {
            font-size: 1.3em;
            color: #1a4d5c;
            text-align: center;
            width: 100%;
            letter-spacing: 1px;
        }

        .xianxia-input {
            padding: 12px 25px;
            border: 2px solid #37c2d4;
            border-radius: 30px;
            font-size: 1.1em;
            background: rgba(255,255,255,0.95);
            resize: none;
            overflow-y: hidden;
            min-height: 50px;
            transition: all 0.3s ease, height 0.2s easeï¼Œ box-shadow 0.5s ease-out;
            width: 80%;
            max-width: 400px;
            margin: 0 auto;
            text-align: center;
        }

        .xianxia-input:focus {
            outline: none;
            box-shadow: 0 0 15px rgba(55, 194, 212, 0.4);
        }

        .random-btn {
            padding: 10px 25px;
            background: linear-gradient(45deg, #00768b, #37c9d4);
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1em;
            letter-spacing: 1px;
            box-shadow: 0 3px 12px rgba(0,0,0,0.15);
        }

        .random-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .submit-section {
            margin-top: 50px;
            text-align: center;
        }

        .action-btn {
            padding: 15px 40px;
            font-size: 1.3em;
            background: linear-gradient(45deg, #00a8c5, #37d4d4);
            border: none;
            border-radius: 30px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 2px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .action-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0,0,0,0.25);
        }

        .ribbon {
            position: absolute;
            width: 180px;
            height: 40px;
            background: linear-gradient(135deg, #37c2d4 0%, #00768b 100%);
            transform: rotate(-45deg);
            box-shadow: 0 3px 12px rgba(0,0,0,0.15);
            animation: float 3s ease-in-out infinite;
            opacity: 0.8;
        }

        @keyframes float {
            0%, 100% { transform: rotate(-45deg) translateY(0); }
            50% { transform: rotate(-45deg) translateY(-10px); }
        }

        @media (max-width: 768px) {
            .xianxia-input {
                width: 90%;
                font-size: 1em;
                min-height: 44px;
            }
            .input-label {
                font-size: 1.1em;
            }
            .random-btn {
                padding: 8px 20px;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="ribbon" style="top:15%; left:8%"></div>
    <div class="ribbon" style="top:25%; right:8%"></div>
    
    <div class="container">
        <h1>âœï¸ æ–°ä½œåˆ›ä½œå° | New Creation</h1>
        
        <form class="creation-form" onsubmit="handleSubmit(event)">
            <div class="input-group">
                <label class="input-label">ä¸»é¢˜ | Theme</label>
                <textarea 
                    class="xianxia-input" 
                    id="theme" 
                    rows="1" 
                    oninput="autoResize(this)"
                    required
                ></textarea>
                <button type="button" class="random-btn" onclick="GenRandomTheme()">éšæœºæ‘‡ä¸€æ‘‡ | Random</button>
            </div>

            <div class="input-group">
                <label class="input-label">ä½œå“å | Title</label>
                <textarea 
                    class="xianxia-input" 
                    id="noveltitle" 
                    rows="1" 
                    oninput="autoResize(this)"
                    required
                ></textarea>
                <button type="button" class="random-btn" onclick="SummarizeTheTheme()">æ€»ç»“ç”Ÿæˆ | Summarize</button>
            </div>

            <div class="input-group">
                <label class="input-label">ä¸»è§’å | Character's name</label>
                <textarea 
                    class="xianxia-input" 
                    id="protagonist" 
                    rows="1" 
                    oninput="autoResize(this)"
                    required
                ></textarea>
                <button type="button" class="random-btn" onclick="GenRandomCharatorName()">éšæœºæ‘‡ä¸€æ‘‡ | Random</button>
            </div>

            <div class="input-group">
                <label class="input-label">ä¸»è§’èƒŒæ™¯ | Character's background</label>
                <textarea 
                    class="xianxia-input" 
                    id="background" 
                    rows="5" 
                    oninput="autoResize(this)"
                    required
                    style="min-height: 120px"
                ></textarea>
                <button type="button" class="random-btn" onclick="GenRandomCharatorBackground()">éšæœºæ‘‡ä¸€æ‘‡ | Random</button>
            </div>

            <div class="input-group">
                <label class="input-label">ç« èŠ‚æ•°é‡é¢„è®¾ | Preset chapter count</label>
                <input type="number" class="xianxia-input" id="chapters" 
                       min="1" max="100" step="1" required
                       oninput="validateInteger(this)">
                <div class="input-hint">ï¼ˆéœ€ä¸ºæ•´æ•°ï¼‰</div>
            </div>

            <div class="submit-section">
                <button type="submit" class="action-btn" onclick="submitNovelData()">ğŸš€ å¼€å§‹åˆ›ä½œ | Start creating</button>
            </div>
        </form>
    </div>

    <script>
        function validateInteger(input) {
            input.value = input.value.replace(/[^0-9]/g, '');
        }

        function handleSubmit(event) {
            event.preventDefault();
            // æäº¤é€»è¾‘
        }

        function GenRandomTheme() {
            const themes = ["é€†å¤©æ”¹å‘½", "å®—é—¨å´›èµ·", "ç§˜å¢ƒæ¢å®", "ä»™é­”ä¹‹æ‹"];
            document.getElementById('theme').value = themes[Math.floor(Math.random()*themes.length)];
        }

        function GenRandomCharatorName() {
            const surnames = ["æ—", "è§", "å¶", "è‹", "æ²ˆ", "æ…•", "å®", "æ¥š", "æ±Ÿ", "æ´›", "ç™½", "å¢¨", 
                              "äº‘", "é£", "å§œ", "æ¸©", "é¡¾", "å¤", "ç§¦", "æŸ³", "éŸ©", "æ±Ÿ", "è´º", "è£´", 
                              "é¢œ", "é™†", "æ—¶", "ç®€", "è®¸"];
            const names = ["å‡¡", "ç‚", "å°˜", "ç‘¶", "é£","äº‘","é›¨","é›·","ç”µ","éœœ","é›ª","å†°","å¯’","å†·",
                           "æ¸…","å¹½","é™","ç©º","è™š","æ— ","å°˜","çƒŸ","é›¾","éœ","è™¹","æ˜Ÿ","æœˆ","å¤œ","æ™“",
                           "æ™¨","æ˜","æš®","æœ","å¤•","é˜³","é˜´","æ˜","æš—","å…‰","å½±","å°˜","æ²™","çŸ³","æœ¨",
                           "æ—","å±±","å·","æ²³","æµ·","æ¹–","æ±Ÿ","æºª","æ³‰","æ½­","æ³¢","æ¶›","æµª","æ½®","æ²™",
                           "å²¸","æ´²","å²›","å²©","å´–","å³°","å²­","å³¦","å²«","å³ª","å³¡","è°·","å£‘","æ¶§","æºª",
                           "ç€‘","æ½­","æ± ","æ²¼","æ³½","æ¸Š", "é£äº‘","å­¤","é€¸å°˜","æµé£","å¯’éœœ","æ¸…æ­Œ","ç–å½±",
                           "æ˜æœˆ",
                           "å‰‘é¸£","å¹½ç¯","é•¿ç”Ÿ","æ— åŒ","æ¸…æ¬¢","å¯’æ±Ÿ","æ˜Ÿæ²³","é’å†¥","è‹èŒ«","ç™½é¹¤","é’è¡«",
                           "ç´ è¡£","äº‘æ·±","å°˜åŸƒ","è½è‹±","é£é›ª","å¯’æ¢…","å†·æœˆ","é’ä¸","ç™½é¦–","å­¤é¸¿","æ®‹é˜³",
                           "çƒŸé›¨","æ¸…ç§‹","å¯’çƒŸ","å†·éœ²","é£èŠ±","æµå¹´","æ¸…æ¢¦","å¹½æ¢¦","å¯’æ½­","å†·æ³‰","é’å³°",
                           "ç™½çŸ³","å­¤æ¾","å¯’æ¾","é£ç€‘","æµæ³‰","æ¸…æºª","å¹½è°·","å¯’æ—","å†·å±±","é’å´–","ç™½äº‘",
                           "å­¤èˆŸ","å¯’èˆŸ","é£é›","æµè¤","æ¸…æ³¢","å¹½æ½­","å¯’æ³¢","å†·æ³¢","é’æ³¢","ç™½äº‘","å­¤é¹¤",
                           "å¯’é¹¤","é£é¸¿","æµäº‘","æ¸…é£","å¹½å…°","å¯’å…°","å†·å…°","é’å…°","ç™½å…°","å­¤æ˜Ÿ","å¯’æ˜Ÿ",
                           "é£æ˜Ÿ","æµæ˜Ÿ","æ¸…å¤œ","å¹½å¤œ","å¯’å¤œ","å†·å¤œ","é’å¤œ","ç™½å¤©","å­¤æœˆ","å¯’æœˆ","é£æœˆ",
                           "æµæœˆ","æ¸…æœˆ","å¹½æœˆ","å¯’å…‰","å†·å…‰","é’å…‰","ç™½å…‰","å­¤å…‰","å¯’çƒŸ","é£çƒŸ","æµçƒŸ",
                           "æ¸…çƒŸ","å¹½çƒŸ","å¯’é›¾","å†·é›¾","é’é›¾","ç™½é›¾","å­¤é›¾","å¯’æ½­","é£æ½­","æµæ½­","æ¸…æ½­",
                           "å¹½æ½­","å¯’æ³‰","å†·æ³‰","é’æ³‰","ç™½æ³‰","å­¤æ³‰","å¯’æ¾","é£æ¾","æµæ¾","æ¸…æ¾","å¹½æ¾",
                           "å¯’ç«¹","å†·ç«¹","é’ç«¹","ç™½ç«¹","å­¤ç«¹","å¯’æ¢…","é£æ¢…","æµæ¢…","æ¸…æ¢…","å¹½æ¢…","å¯’æŸ³",
                           "å†·æŸ³","é’æŸ³","ç™½æŸ³","å­¤æŸ³","å¯’æ«","é£æ«","æµæ«","æ¸…æ«","å¹½æ«","å¯’èŠ","å†·èŠ",
                           "é’èŠ","ç™½èŠ","å­¤èŠ","å¯’è²","é£è²","æµè²","æ¸…è²","å¹½è²","å¯’è·","å†·è·","é’è·",
                           "ç™½è·","å­¤è·","å¯’èŠ","é£èŠ","æµèŠ","æ¸…èŠ","å¹½èŠ","å¯’èŠ","å†·èŠ","é’èŠ","ç™½èŠ",
                           "å­¤èŠ"];
            document.getElementById('protagonist').value = 
                surnames[Math.floor(Math.random()*surnames.length)] +
                names[Math.floor(Math.random()*names.length)];
        }

        function GenRandomCharatorBackground() {
            const backgrounds = [
                "å¤©ç”ŸåºŸçµæ ¹å´æ„å¤–è·å¾—ä¸Šå¤ä¼ æ‰¿",
                "è¢«ç­é—¨çš„å®—é—¨å”¯ä¸€å¹¸å­˜å¼Ÿå­",
                "è½¬ä¸–é‡ä¿®çš„ä»™ç•Œå¤§èƒ½",
                "æ‹¥æœ‰ç‰¹æ®Šä½“è´¨çš„å¦–æ—æ··è¡€"
            ];
            document.getElementById('background').value = backgrounds[Math.floor(Math.random()*backgrounds.length)];
        }

        function SummarizeTheTheme() {
            const themeInput = document.getElementById('theme');
            const titleInput = document.getElementById('noveltitle');

            if (!themeInput.value.trim()) {
                alert('è¯·å…ˆè¾“å…¥æˆ–ç”Ÿæˆä¸»é¢˜');
                themeInput.focus();
                return;
            }
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            titleInput.placeholder = "Generating...";
            const originalText = titleInput.value;
            titleInput.value = "";

            fetch('/api/summarize-novel-theme', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ 
                    theme: themeInput.value
                })
            })
            .then(response => {
                if (!response.ok) throw new Error(`HTTPé”™è¯¯ ${response.status}`);
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    titleInput.value = data.generatedTitle;
                    titleInput.style.animation = 'glow 1s ease-out';
                } else {
                    titleInput.value = originalText;
                    alert(`failed to gen title: ${data.error || 'unknown error'}`);
                }
            })
            .catch(error => {
                console.error('exception: ', error);
                titleInput.value = originalText;
                alert('connection error');
            })
            .finally(() => {
                titleInput.placeholder = "";
            });
        }

        function submitNovelData() {
            // æ”¶é›†æ‰€æœ‰è¾“å…¥æ•°æ®
            const novelData = {
                theme: document.getElementById('theme').value,
                title: document.getElementById('noveltitle').value,
                protagonist: document.getElementById('protagonist').value,
                background: document.getElementById('background').value,
                chapters: document.getElementById('chapters').value
            };

            fetch('/api/generate-novel-setting', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(novelData)
            })
            .then(response => response.json())
            .then(data => {
                if(data.success) {
                    alert('data written in');
                    console.log('ç”Ÿæˆç»“æœ:', data.filepath);
                } else {
                    alert('error: ' + data.error);
                }
            })
            .catch(error => {
                console.error('exception:', error);
                alert('exception occurred');
            });
            window.location.href = '/creation_content?type=new';
        }
    </script>
</body>
</html>
